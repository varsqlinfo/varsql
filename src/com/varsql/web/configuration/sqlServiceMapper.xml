<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sqlServiceMapper">
	<insert id="sqlServiceMapper.insertSqlUserLog" parameterType="java.util.Map">
		insert into vtsql_log (
			vconnid
			, uid
			, start_time
			, s_mm
			, s_dd
			, s_hh
			, end_time
			, delay_time
			, log_sql
			, result_count
			, command_type
		)
		values( 
			#{vconnid}
			, #{uid}
			, #{start_time}
			, #{s_mm}
			, #{s_dd}
			, #{s_hh}
			, #{end_time}
			, #{delay_time}
			, #{log_sql}
			, #{result_count}
			, #{command_type}
		)
	</insert>
	
	<insert id="sqlServiceMapper.saveQueryInfo" parameterType="java.util.Map">
		insert  into VTSQL_BOARD (
			UID
			, VCONNID
			, SQL_ID
			, GUERY_TITLE
			, QUERY_CONT
			, REG_DT
			, UPD_DT
		) 
		values(
			#{uid}
			, #{vconnid}
			, #{sql_id}
			, #{sqlTitle}
			, #{sql}
			, CURRENT TIMESTAMP
			, CURRENT TIMESTAMP
		)
	</insert>
	<update id="sqlServiceMapper.updateQueryInfo" parameterType="java.util.Map">
		update VTSQL_BOARD 
		set
			 GUERY_TITLE = #{sqlTitle}
			, QUERY_CONT = #{sql}
			, UPD_DT = CURRENT TIMESTAMP
		where sql_id = #{sql_id}
		and VCONNID = #{vconnid}
		and UID = #{uid}
	</update>
	
	<select id="sqlServiceMapper.selectLastSqlInfo" parameterType="map" resultType="map">
		select * from VTSQL_BOARD
		where VCONNID = #{vconnid}
		and UID = #{uid}
		order by upd_dt desc
		FETCH FIRST 1 ROWS ONLY
	</select>
	
	<select id="sqlServiceMapper.selectSqlList" parameterType="map" resultType="map">
		select * from VTSQL_BOARD
		where VCONNID = #{vconnid}
		and UID = #{uid}
		order by upd_dt desc
	</select>
</mapper>
